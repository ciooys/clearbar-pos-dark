
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>扫码下单 - Clearbar</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: linear-gradient(180deg,#0b0b0d,#121212); color:#efece6; font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial; }
    .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.04); }
    .accent { color: #d4af37; }
    .btn-accent { background:#d4af37; color:#121212; border: none; }
  </style>
</head>
<body>
<div class="container py-4">
  <h4 class="accent">Clearbar · 扫码点单</h4>
  <div id="items" class="row"></div>
  <hr>
  <h5>购物车</h5>
  <ul id="cart" class="list-group mb-2"></ul>
  <div>合计：<span class="accent">¥ <span id="total">0</span></span></div>
  <div class="mt-2">
    <button class="btn btn-accent" onclick="checkout()">提交订单（演示）</button>
  </div>
</div>
<script>
let items=[]; let cart=[];
fetch("/api/inventory").then(r=>r.json()).then(d=>{ items=d; const el=document.getElementById("items"); d.forEach(it=>{ el.innerHTML+=`<div class="col-md-4 mb-2"><div class="card p-3"><h6>${it.name}</h6><div>¥ ${it.price}</div><button class="btn btn-sm btn-outline-light mt-2" onclick='add(${it.id})'>加入购物车</button></div></div>` }); });

function add(id){ const it = items.find(x=>x.id===id); const ex = cart.find(x=>x.inventory_id===id); if(ex) ex.qty++; else cart.push({inventory_id:id, qty:1, price:it.price, name:it.name}); render(); }
function render(){ const el=document.getElementById("cart"); el.innerHTML=""; let t=0; cart.forEach((c,idx)=>{ t+=c.qty*c.price; el.innerHTML+=`<li class="list-group-item d-flex justify-content-between align-items-center">${c.name} x ${c.qty} <div><button class="btn btn-sm btn-secondary" onclick="dec(${idx})">-</button> <button class="btn btn-sm btn-secondary" onclick="inc(${idx})">+</button></div></li>`}); document.getElementById("total").innerText = t.toFixed(2); }
function dec(i){ cart[i].qty--; if(cart[i].qty<=0) cart.splice(i,1); render(); } function inc(i){ cart[i].qty++; render(); }
function checkout(){ fetch("/api/orders", {method:"POST", headers:{'Content-Type':'application/json'}, body: JSON.stringify({items: cart})}).then(r=>r.json()).then(d=>{ if(d.ok){ alert("下单成功，订单号:"+d.order_no); cart=[]; render(); } else alert("下单失败"); }); }
</script>
</body>
</html>
